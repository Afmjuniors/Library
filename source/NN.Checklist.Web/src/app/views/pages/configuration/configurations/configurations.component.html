<div class="my-container">
	<ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '0px' }"></ngx-loading>
</div>
<kt-portlet>
	<kt-portlet-body>
		<kt-alert *ngIf="error" type="warn" [duration]="5000" [showCloseButton]="true">
		</kt-alert>

		<div class="row">
			<div class="col-lg-12">
				<mat-accordion>
					<mat-expansion-panel>
						<mat-expansion-panel-header>
							<mat-panel-title>
								{{ 'MENU.FILTERS' | translate }}
							</mat-panel-title>
						</mat-expansion-panel-header>
						<div class="row">
							<div class="col-md-6">
								<mat-form-field class="full-width">
									<mat-select placeholder="{{ 'MENU.PROCESS' | translate }}"
										[(ngModel)]="registerFilters.processId" class="full-width"
										(selectionChange)="loadListAreas($event.value)">
										<mat-option value="0"></mat-option>
										<mat-option *ngFor="let item of processes" [value]="item.processId">
											{{item.acronym}} - {{item.description}}
										</mat-option>
									</mat-select>
								</mat-form-field>
							</div>
							<div class="col-md-6">
								<mat-form-field class="full-width">
									<mat-select placeholder="{{ 'MENU.AREA' | translate }}"
										[(ngModel)]="registerFilters.areaId" class="full-width"
										[disabled]="areas == null || areas.length == 0">
										<mat-option value="0"></mat-option>
										<mat-option *ngFor="let item of areas" [value]="item.areaId">
											{{item.name}} - {{item.description}}
										</mat-option>
									</mat-select>
								</mat-form-field>
							</div>
						</div>
						<div class="row">
							<div class="col-md-6">
								<mat-form-field class="full-width">
									<mat-select placeholder="{{ 'MENU.TYPE' | translate }}" [(ngModel)]="registerFilters.typeId" class="full-width">
										<mat-option value="0"></mat-option>
										<mat-option value="1">{{ "ALARM" | translate }}</mat-option>
										<mat-option value="2">{{ "EVENT" | translate }}</mat-option>
										<mat-option value="3">{{ "WARNING" | translate }}</mat-option>
										<mat-option value="4">{{ "MENU.MESSAGE" | translate }}</mat-option>
									</mat-select>
								</mat-form-field>
							</div>
							<div class="col-md-6">
								<mat-form-field class="full-width">
									<mat-select placeholder="{{ 'REQUIRES_APPROVAL' | translate }}" [(ngModel)]="registerFilters.assesmentNeeded" class="full-width">
										<mat-option [value]="null"></mat-option>
										<mat-option [value]="true">{{ "YES" | translate }}</mat-option>
										<mat-option [value]="false">{{ "NO" | translate }}</mat-option>
									</mat-select>
								</mat-form-field>
							</div>
						</div>
						<div class="row">
							<div class="col-md-5">
								<mat-form-field class="full-width">
									<mat-label>{{ "TAG" | translate }}</mat-label>
									<input type="text" matInput autocomplete="off" [(ngModel)]="registerFilters.tag">
								</mat-form-field>
							</div>
						</div>
						<div class="row">
							<div class="d-flex" style="min-width: 300px;">
								<button mat-button
									style="height: 50px; width: 100%; padding: 10px; margin: 10px"
									mat-raised-button (click)="LoadByFilters()" color="primary" type="button">
									<span>{{ 'MENU.FILTER' | translate }}</span>
								</button>
								<button mat-button
									style="height: 50px; width: 100%; padding: 10px; margin: 10px"
									mat-raised-button (click)="ClearFilters()" color="primary" type="button">
									<span>{{ 'MENU.CLEAR' | translate }}</span>
								</button>
							</div>
						</div>
					</mat-expansion-panel>
				</mat-accordion>
				<hr />
			</div>
		</div>

		<div class="row">
			<div class="d-flex" style="min-width: 150px;">
				<button mat-button style="height: 50px; width: 100%; padding: 10px; margin: 10px" mat-raised-button
					color="primary" type="button" (click)="sendEmailCSV()" [disabled]="!currentRegisters.hasItems">
					<span>{{ 'MENU.SEND_XLS' | translate }}</span>
				</button>
			</div>
			<div class="d-flex" style="min-width: 150px;">
				<button mat-button style="height: 50px; width: 100%; padding: 10px; margin: 10px" mat-raised-button
					color="primary" type="button" (click)="sendEmailPdf()" [disabled]="!currentRegisters.hasItems">
					<span>{{ 'MENU.SEND_PDF' | translate }}</span>
				</button>
			</div>
		</div>

		<div class="row">
			<div class="col-lg-5" style="padding-bottom: 10px;">
				<div class="row">
					<div class="col-lg-12">
						<mat-card>
							<mat-card-title>
								<h5>{{ 'AUTH.CONFIGURATION.CURRENT_REGISTERS' | translate }}</h5>
							</mat-card-title>
							<mat-card-content>
								<div class="row">
									<div class="col-lg-12">
										<div class="mat-table__wrapper">
											<mat-table class="lmat-elevation-z8" #table [dataSource]="currentRegisters"
												matSort #sort1="matSort" matSortActive="id" matSortDirection="asc"
												matSortDisableClear style="min-width: 0 !important;">

												<ng-container matColumnDef="selected">
													<mat-header-cell *matHeaderCellDef style="max-width: 10%;">
													</mat-header-cell>
													<mat-cell *matCellDef="let register" style="max-width: 10%;">
														<mat-checkbox [(ngModel)]="register.selected" ></mat-checkbox>
													</mat-cell>
												</ng-container>

												<ng-container matColumnDef="tag">
													<mat-header-cell *matHeaderCellDef>{{ "MENU.TAG" | translate }}
													</mat-header-cell>
													<mat-cell *matCellDef="let register">{{register.tag}}</mat-cell>
												</ng-container>

												<ng-container matColumnDef="process">
													<mat-header-cell *matHeaderCellDef style="max-width: 13%;">{{
														"MENU.PROCESS" | translate }}</mat-header-cell>
													<mat-cell *matCellDef="let register" style="max-width: 13%;">
														{{register.process}}</mat-cell>
												</ng-container>

												<ng-container matColumnDef="area">
													<mat-header-cell *matHeaderCellDef style="max-width: 13%;">{{
														"MENU.AREA" | translate }}</mat-header-cell>
													<mat-cell *matCellDef="let register" style="max-width: 13%;">
														{{register.area}}</mat-cell>
												</ng-container>

												<ng-container matColumnDef="type">
													<mat-header-cell *matHeaderCellDef>{{ "MENU.TYPE" | translate }}
													</mat-header-cell>
													<mat-cell *matCellDef="let register">{{register.type}}</mat-cell>
												</ng-container>

												<mat-header-row *matHeaderRowDef="columnRegisters"
													style="max-width: 100%;"></mat-header-row>

												<mat-row *matRowDef="let row; columns: columnRegisters"
													style="max-width: 100%;"></mat-row>
											</mat-table>

											<div *ngIf="currentRegisters != null">
												<div class="mat-table__message" *ngIf="!currentRegisters.hasItems">{{
													"MENU.NO_RECORDS" | translate }}</div>
											</div>
											<!-- Message for empty data  -->
											<div *ngIf="currentRegisters != null">
												<div class="mat-table__message"
													*ngIf="currentRegisters.isPreloadTextViewed$ | async">{{
													"MENU.PLEASE_WAIT" | translate }}</div>
											</div>
										</div>
										<div class="mat-table__bottom">

											<mat-spinner [color]="'primary'" [diameter]="20" *ngIf="currentRegisters.loading$ | async"></mat-spinner>
											<mat-paginator [pageSize]="10" [pageSizeOptions]="[5, 10, 20]"
												[length]="currentRegisters.paginatorTotal$ | async"
												[showFirstLastButtons]="true"></mat-paginator>
										</div>
									</div>
								</div>

							</mat-card-content>
						</mat-card>
					</div>
				</div>

			</div>
			<div class="col-lg-1" style="padding-top: 15%;">
				<div style="padding: 5%;">
					<button mat-raised-button color="primary" (click)="addRegisterAll()" >
						>> >>
					</button>
				</div>
				<div style="padding: 5%;">
					<button mat-raised-button color="primary" (click)="addRegister()" >
						>>
					</button>
				</div>
				<div style="padding: 5%;">
					<button mat-raised-button color="primary" (click)="removeRegister()">
						<<
					</button>
				</div>
				<div style="padding: 5%;">
					<button mat-raised-button color="primary" (click)="removeRegisterAll()">
						<< <<
					</button>
				</div>
			</div>
			<div class="col-lg-6" style="padding-bottom: 10px;">

				<div class="row">
					<div class="col-lg-2" style="margin-bottom: 4%;">
						<button mat-button mat-raised-button (click)="newRegister()"
							color="primary" type="button">
							<span>
								{{ 'NEW_RECORD' | translate }}
							</span>
						</button>
					</div>
					<div class="col-lg-2 full-width" style="margin-bottom: 4%;">
						<button mat-button mat-raised-button (click)="editRegisterConfiguration()"
							color="primary" type="button" [disabled]="selectedList == null || selectedList.length == 0">
							<span>
								{{ 'MENU.EDIT_RECORDS' | translate }}
							</span>
						</button>
					</div>
				</div>

				<div class="row form-group">
					<mat-card class="full-width" style="width: 100%;">
						<mat-card-title>
							<h5>{{ 'AUTH.CONFIGURATION.TYPE_OCCURRENCES_RECORDS_SELECTED' | translate }}</h5>
						</mat-card-title>
						<div class="mat-table__wrapper">
							<div class="table-responsive">
								<table class="table table-lista table-striped table-hover">

									<thead>
										<tr>
											<th>{{ "MENU.DELETE" | translate }}</th>
											<th>{{ "MENU.TAG" | translate }}</th>
											<th>{{ "MENU.PROCESS" | translate }}</th>
											<th>{{ "MENU.AREA" | translate }}</th>
											<th>{{ "MENU.TYPE" | translate }}</th>
										</tr>
									</thead>
									<tbody>
										<tr *ngFor="let item, let index of selectedList">
											<td>
												<!-- <span class="material-icons mt-3 userIcon view" (click)="removeRegisterList(index)">
													delete
												</span> -->
												<mat-checkbox [(ngModel)]="item.selected"></mat-checkbox>
											</td>
											<td>
												{{item.tag}}
											</td>
											<td>
												{{item.process}}
											</td>
											<td>
												{{item.area}}
											</td>
											<td>
												{{item.type}}
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</mat-card>
				</div>
			</div>
		</div>
	</kt-portlet-body>
</kt-portlet>
